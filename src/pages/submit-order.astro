---
import AuthLayout from "../components/AuthLayout.astro";
import { getUser } from "../utils/auth";

const user = await getUser(Astro.cookies);

if (!user) {
  return Astro.redirect('/login');
}

let success = '';
let error = '';
const url = new URL(Astro.request.url);
success = url.searchParams.get('success') || '';
error = url.searchParams.get('error') || '';
---

<AuthLayout title="Submit Order" user={user}>
  <div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-8 border-2 border-abbco-gold/20">
      <h1 class="text-3xl font-bold text-abbco-gold mb-6">Submit Order</h1>
      
      {success && (
        <div class="mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg">
          {success}
        </div>
      )}
      
      {error && (
        <div class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
          {error}
        </div>
      )}

      <form action="/api/orders/submit" method="POST" class="space-y-6">
        <div>
          <label for="order_number" class="block text-sm font-semibold mb-2">
            Order Number <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="order_number"
            name="order_number"
            required
            placeholder="e.g., 123-4567890-1234567"
            class="w-full px-4 py-3 border border-abbco-charcoal/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-abbco-gold"
          />
        </div>

        <div>
          <label for="source" class="block text-sm font-semibold mb-2">
            Order Source <span class="text-red-500">*</span>
          </label>
          <select
            id="source"
            name="source"
            required
            class="w-full px-4 py-3 border border-abbco-charcoal/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-abbco-gold"
          >
            <option value="">Select source...</option>
            <option value="amazon">Amazon</option>
            <option value="shopify">Shopify</option>
          </select>
        </div>

        <div>
          <label for="order_date" class="block text-sm font-semibold mb-2">
            Order Date <span class="text-red-500">*</span>
          </label>
          <input
            type="date"
            id="order_date"
            name="order_date"
            required
            max={new Date().toISOString().split('T')[0]}
            class="w-full px-4 py-3 border border-abbco-charcoal/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-abbco-gold"
          />
        </div>

        <div>
          <label for="receipt_url" class="block text-sm font-semibold mb-2">
            Receipt/Screenshot URL (optional)
          </label>
          <input
            type="url"
            id="receipt_url"
            name="receipt_url"
            placeholder="https://..."
            class="w-full px-4 py-3 border border-abbco-charcoal/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-abbco-gold"
          />
          <p class="mt-1 text-sm text-abbco-charcoal/60">
            Upload your receipt to a service like Imgur or Google Drive and paste the link here
          </p>
        </div>

        <div class="bg-abbco-cream/50 rounded-lg p-4 border border-abbco-gold/20">
          <h3 class="font-semibold mb-2 text-abbco-gold">How it works:</h3>
          <ol class="list-decimal list-inside space-y-1 text-sm text-abbco-charcoal/80">
            <li>Submit your Amazon or Shopify order number</li>
            <li>Our team will verify your purchase</li>
            <li>Once verified, it counts toward your 5 orders needed</li>
            <li>When you reach 5 verified orders, claim your free product!</li>
          </ol>
        </div>

        <div class="flex gap-4">
          <button
            type="submit"
            class="flex-1 bg-abbco-gold text-white font-semibold py-3 rounded-lg hover:bg-abbco-gold/90 transition"
          >
            Submit Order
          </button>
          <a
            href="/dashboard"
            class="flex-1 bg-abbco-charcoal/10 text-abbco-charcoal font-semibold py-3 rounded-lg hover:bg-abbco-charcoal/20 transition text-center"
          >
            Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</AuthLayout>
